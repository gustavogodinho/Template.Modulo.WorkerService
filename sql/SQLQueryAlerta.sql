-- drop table ALERTA_SEGURANCA;
-- drop table ALERTA_SEGURANCA_dados
 
 CREATE TABLE ALERTA_SEGURANCA
    (
        CD_ALERTA_SEGURANCA INT,
        NM_ALERTA_SEGURANCA VARCHAR(50),
        CD_PESSOA INT,
        ALERTA_TEMPO INT,
        DT_CRIACAO datetime,
        ALERTA_ATIVO INT, 
        DS_MENSAGEM VARCHAR(100),
        DS_CONTATOS VARCHAR(200)
    );

	 CREATE TABLE  ALERTA_SEGURANCA_DADOS
    (
        CD_ALERTA_SEGURANCA_DADOS INT,
        CD_ALERTA_SEGURANCA INT,
        DT_ALERTA_INICIO datetime,
        DT_ALERTA_FIM datetime, 
        LATITUDE_INICIO VARCHAR(50), 
        LONGITUDE_INICIO VARCHAR(50),
        LATITUDE_FIM  VARCHAR(50),
        LONGITUDE_FIM  VARCHAR(50),
        DESATIVACAO_MANUAL INT
    );

	
SELECT * FROM ALERTA_SEGURANCA

INSERT INTO ALERTA_SEGURANCA VALUES (2, 'PRIMEIRO ALERTA', 999999, 600000, GETDATE(), 0, 'Nome: Era pra ter chego em casa', '{"Telefone": ["11991164957","1150963240","11991164957","11902190299","22192012909"]}')
INSERT INTO ALERTA_SEGURANCA VALUES (3, 'PRIMEIRO ALERTA', 999999, 600000, GETDATE(), 0, 'Nome: Era pra ter chego em casa', '{"Telefone": ["11991164957","1150963240","11991164957","11902190299","22192012909"]}')


SELECT * FROM ALERTA_SEGURANCA_DADOS

INSERT INTO ALERTA_SEGURANCA_DADOS 
VALUES (2,2, GETDATE(),NULL, '-23.5956131','-46.7272185', NULL, NULL, NULL);

UPDATE ALERTA_SEGURANCA SET ALERTA_ATIVO = 1  WHERE CD_ALERTA_SEGURANCA = 2; 
UPDATE ALERTA_SEGURANCA_DADOS SET DT_ALERTA_FIM = GETDATE(), DESATIVACAO_MANUAL = 0 WHERE CD_ALERTA_SEGURANCA_DADOS = 2


SELECT * 
 FROM ALERTA_SEGURANCA A
 INNER JOIN ALERTA_SEGURANCA_DADOS B
	 ON A.CD_ALERTA_SEGURANCA = B.CD_ALERTA_SEGURANCA
	 WHERE A.ALERTA_ATIVO = 1
	 AND B.DT_ALERTA_FIM IS NULL 
